<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô | Hom Noei Bakery</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .admin-wrap{max-width:980px;margin:30px auto;padding:0 16px;}
    .admin-card{background:#fff;border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,.08);padding:18px;}
    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;}
    .tab-btn{border:none;background:#f3ede3;color:#5A3E2B;padding:10px 14px;border-radius:14px;cursor:pointer;font-weight:700}
    .tab-btn.active{background:linear-gradient(135deg,#8A5A3A,#C28C5C);color:#fff}
    .row{display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:10px;align-items:center}
    .row input{padding:12px;border:1px solid #ddd;border-radius:12px;font-size:15px;width:100%}
    .list{margin-top:14px;display:flex;flex-direction:column;gap:10px}
    .item{display:flex;gap:12px;align-items:center;border:1px solid #eee;border-radius:14px;padding:10px}
    .item img{width:56px;height:56px;object-fit:cover;border-radius:12px;background:#f5f5f5}
    .item .meta{flex:1}
    .item .meta b{display:block;color:#5A3E2B}
    .item small{color:#777}
    .btn-mini{padding:10px 12px;border:none;border-radius:12px;cursor:pointer}
    .btn-del{background:#b42318;color:#fff}
    .btn-go{background:#eee;color:#5A3E2B}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:700px){
      .row{grid-template-columns:1fr; }
      .grid2{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>

<header class="site-header">
  <div class="brand">üîß <span>Admin Dashboard</span></div>
  <nav class="main-nav">
    <a href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</a>
    <a href="menu.html">‡πÄ‡∏°‡∏ô‡∏π</a>
  </nav>
  <div class="header-actions">
    <div class="user-menu">
      <button class="user-btn" id="logoutBtn" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">üö™</button>
    </div>
  </div>
</header>

<div class="admin-wrap">
  <div class="admin-card">
    <div class="tabs">
      <button class="tab-btn active" data-tab="products">üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
      <button class="tab-btn" data-tab="staff">üë§ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
      <button class="tab-btn" data-tab="customers">üßæ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button>
    </div>

    <!-- PRODUCTS -->
    <section id="tab-products">
      <h2 style="margin:6px 0 12px;color:#5A3E2B;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

      <div class="row">
        <input id="pName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô Butter Sugar Toast">
        <input id="pPrice" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô 120">
        <input id="pImage" placeholder="‡∏£‡∏π‡∏õ (path/URL) ‡πÄ‡∏ä‡πà‡∏ô images/1.2.png">
        <button class="btn-main" style="width:auto;padding:12px 16px" onclick="addProduct()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      </div>

      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn-soft" style="width:auto" onclick="loadProducts()">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
        <button class="btn-soft" style="width:auto" onclick="location.href='menu.html'">‡πÑ‡∏õ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô (‡πÄ‡∏°‡∏ô‡∏π)</button>
      </div>

      <div class="list" id="productList"></div>
    </section>

    <!-- STAFF -->
    <section id="tab-staff" style="display:none">
      <h2 style="margin:6px 0 12px;color:#5A3E2B;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
      <div class="row" style="grid-template-columns:1fr 1fr auto;">
        <input id="sUser" placeholder="Username ‡πÄ‡∏ä‡πà‡∏ô Admin2">
        <input id="sPass" placeholder="Password ‡πÄ‡∏ä‡πà‡∏ô 1234">
        <button class="btn-main" style="width:auto;padding:12px 16px" onclick="addStaff()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      </div>
      <div class="list" id="staffList"></div>
      <p style="color:#777;margin-top:10px;">* ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: Admin / 1234</p>
    </section>

    <!-- CUSTOMERS -->
    <section id="tab-customers" style="display:none">
      <h2 style="margin:6px 0 12px;color:#5A3E2B;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
      <div class="list" id="customerList"></div>
      <p style="color:#777;margin-top:10px;">* ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ú‡πà‡∏≤‡∏ô register</p>
    </section>
  </div>
</div>

<script>
/* ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏≠‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ */
if (localStorage.getItem("role") !== "staff") {
  location.href = "staff-login.html";
}

document.getElementById("logoutBtn").onclick = () => {
  localStorage.removeItem("role");
  localStorage.removeItem("staffName");
  location.href = "login.html";
};

/* Tabs */
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    const tab = btn.dataset.tab;
    document.getElementById("tab-products").style.display = tab==="products" ? "block" : "none";
    document.getElementById("tab-staff").style.display = tab==="staff" ? "block" : "none";
    document.getElementById("tab-customers").style.display = tab==="customers" ? "block" : "none";

    if(tab==="products") loadProducts();
    if(tab==="staff") loadStaff();
    if(tab==="customers") loadCustomers();
  });
});

/* Helpers */
async function api(action, body){
  const res = await fetch("api/api.php?action=" + action, {
    method:"POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(body || {})
  });
  return await res.json();
}

/* PRODUCTS */
async function loadProducts(){
  const res = await fetch("api/api.php?action=products_list");
  const j = await res.json();
  const box = document.getElementById("productList");
  if(!j.ok){ box.innerHTML = "<p>‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</p>"; return; }
  if(j.data.length===0){ box.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>"; return; }

  box.innerHTML = j.data.map(p=>`
    <div class="item">
      <img src="${p.image || 'images/no-image.png'}" alt="">
      <div class="meta">
        <b>${p.name}</b>
        <small>${p.price} ‡∏ö‡∏≤‡∏ó ‚Ä¢ #${p.id}</small>
      </div>
      <button class="btn-mini btn-del" onclick="delProduct(${p.id})">‡∏•‡∏ö</button>
    </div>
  `).join("");
}

async function addProduct(){
  const name = document.getElementById("pName").value.trim();
  const price = Number(document.getElementById("pPrice").value);
  const image = document.getElementById("pImage").value.trim();

  const j = await api("product_add", {name, price, image});
  if(!j.ok){ alert(j.msg); return; }

  document.getElementById("pName").value="";
  document.getElementById("pPrice").value="";
  document.getElementById("pImage").value="";
  await loadProducts();

  // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô (‡πÄ‡∏°‡∏ô‡∏π)
  if(confirm("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚úÖ ‡πÑ‡∏õ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏¢‡πÑ‡∏´‡∏°?")){
    location.href="menu.html";
  }
}

async function delProduct(id){
  if(!confirm("‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ?")) return;
  const j = await api("product_delete", {id});
  if(!j.ok){ alert(j.msg); return; }
  loadProducts();
}

/* STAFF */
async function loadStaff(){
  const res = await fetch("api/api.php?action=staff_list");
  const j = await res.json();
  const box = document.getElementById("staffList");
  if(!j.ok){ box.innerHTML="<p>‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</p>"; return; }
  if(j.data.length===0){ box.innerHTML="<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>"; return; }

  box.innerHTML = j.data.map(s=>`
    <div class="item">
      <div class="meta">
        <b>${s.username}</b>
        <small>#${s.id} ‚Ä¢ ${s.created_at || ""}</small>
      </div>
      <button class="btn-mini btn-del" onclick="delStaff(${s.id},'${s.username}')">‡∏•‡∏ö</button>
    </div>
  `).join("");
}

async function addStaff(){
  const username = document.getElementById("sUser").value.trim();
  const password = document.getElementById("sPass").value.trim();
  const j = await api("staff_add", {username, password});
  if(!j.ok){ alert(j.msg); return; }
  document.getElementById("sUser").value="";
  document.getElementById("sPass").value="";
  loadStaff();
}

async function delStaff(id, username){
  if(username==="Admin"){ alert("‡∏Å‡∏±‡∏ô‡∏û‡∏•‡∏≤‡∏î: ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö Admin"); return; }
  if(!confirm("‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô "+username+" ?")) return;
  const j = await api("staff_delete", {id});
  if(!j.ok){ alert(j.msg); return; }
  loadStaff();
}

/* CUSTOMERS */
async function loadCustomers(){
  const res = await fetch("api/api.php?action=customers_list");
  const j = await res.json();
  const box = document.getElementById("customerList");
  if(!j.ok){ box.innerHTML="<p>‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</p>"; return; }
  if(j.data.length===0){ box.innerHTML="<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>"; return; }

  box.innerHTML = j.data.map(c=>`
    <div class="item" style="align-items:flex-start">
      <div class="meta" style="width:100%">
        <b>#${c.id} ‚Ä¢ ${c.username}</b>
        <small>${c.email || ""}</small>
        <div class="grid2" style="margin-top:10px">
          <input value="${c.username}" id="cu-${c.id}">
          <input value="${c.email || ""}" id="ce-${c.id}" placeholder="email">
        </div>
        <div style="margin-top:10px;display:flex;gap:10px;justify-content:flex-end">
          <button class="btn-mini btn-go" onclick="saveCustomer(${c.id})">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </div>
    </div>
  `).join("");
}

async function saveCustomer(id){
  const username = document.getElementById("cu-"+id).value.trim();
  const email = document.getElementById("ce-"+id).value.trim();
  const j = await api("customer_update", {id, username, email});
  if(!j.ok){ alert(j.msg); return; }
  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
  loadCustomers();
}

/* init */
loadProducts();
</script>

</body>
</html>
